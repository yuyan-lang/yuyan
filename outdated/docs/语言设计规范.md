

# 模块系统

请允许我从模块系统来介绍豫言编程语言的设计。豫言有两种乘积类型：
```
1. 带标记(label)的乘积，用结构体来表示。这种乘积在别的编程语言又称为记录（record）或者接口（interface）。
2. 不带标记的乘积，如`丙寅合丁卯`。
```
结构体根据语境既可表示接口，也可表示接口的实现。在表示接口时，不可以有`。。。者。。。也`的定义句。在表示接口实现时，不可以有未定义的，`。。。为。。。也。`的句子。
第一种乘积类型即为一个模块的类型。第二个乘积类型则为普通tuple的类型。当一个模块不指定其类型时，编译器会指定其类型。同样，如果一个表达式的类型是带标记的乘积，那么其一定是一个结构体，（又称模块）。

模块系统的投影（projection）应用`之`，每一个名字都可以通过之字分为若干部分。第二个结构的投影用关键词`中`。

每个文件都被当做一个模块，如果文件的第一项声明是本文件的结构名的话，则结构块代指它。且该文件不得包含其余结构。例如，在一个名为`甲辰。豫`的文件中

```
甲辰者「
子者。。。也。
。。。
」也。
```
则其他文件引用甲辰时就会自动引用这个结构块。如果除本名结构块以外又有注释以外的其他内容，
```
甲辰者「
子者。。。也。
。。。
」也。
丑者。。。也。
```
则编译器会报错。

如果没有结构块声名：
```
辰者。。。也。
。。。
巳者。。。也。
```

则系统会自动在最外层添加一个结构声明

```
甲辰者「
辰者。。。也。
。。。
巳者。。。也。
」也。
```


### 库的搜索顺序
当一个名字出现在程序中时，系统会按照以下顺序解析名字：
举例 `甲寅之乙卯之丙申`。

#### 如为导入语句

此句表示搜索`甲寅`文件夹下的`乙卯`文件夹下的`丙申。豫`文件。

系统会按照如下顺序搜索文件夹：

1. 当前文件夹：
在当前文件夹下搜索名为甲寅的文件夹。
<!-- 。如果甲寅是文件夹，则我们会在甲寅文件夹下继续搜索。注意：名称中如果仅仅是文件夹的话，搜索不会成功。其中一项必须是文件名。如果结构名与文件名相同，例如在`甲寅。豫`中解析`甲寅之X`，则会跳过本文件而直接搜索名为`甲寅`的文件夹。 -->

1. 局部搜索：
在当前执行目录下的`豫言依赖包`与`yylib`目录中执行前步搜索。

1. 全局搜索：
系统全局可以有一个例如`~/.yuyan/lib`的文件夹存放全系统包。搜索方法与局部搜索类似。

### 如为普通语句

系统会在当前模块中（包含其导入语句）中依次搜索名为`甲寅`，`甲寅之乙卯`，`甲寅之乙卯之丙申`的结构。以第一个搜索到的为准。

1. 当前文件：
如果当前文件存在名为甲寅的结构，则`甲寅之乙卯之丙申`指代甲寅结构中乙卯之丙申。



## 表达式的模块实现

### 表达式中的结构声明(let in)

表达式`虑。。。以成。。。之道`，如`虑甲以成乙之道`则可以这样理解：
1. 定义了一个匿名的内部结构甲
2. 在乙中打开（open）了甲(用`观。。。书`的形式)

### 定义的透明性

非递归定义，即没有声明的定义
如果非透明，那么内部外部看都只有其类型
如果透明，内部外部都可以看到其定义

递归定义，即有声明的定义
声明透明性控制外部的定义可见性
定义透明性控制定义后的定义可见性
* 目前模块内部不支持递归定义，但模块外部支持递归定义